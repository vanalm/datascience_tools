<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Data Analysis Report</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        h1 {
            color: #333;
        }

        h2 {
            color: #555;
            border-bottom: 1px solid #ccc;
            padding-bottom: 5px;
        }

        h3 {
            color: #666;
            margin-top: 30px;
        }

        h4 {
            color: #777;
            margin-top: 20px;
        }

        table {
            border-collapse: collapse;
            width: 100%;
            margin-bottom: 20px;
        }

        th,
        td {
            text-align: left;
            padding: 8px;
            border: 1px solid #ddd;
        }

        th {
            background-color: #f2f2f2;
        }

        img {
            max-width: 100%;
            height: auto;
            margin-bottom: 20px;
        }

        .section {
            margin-bottom: 60px;
        }

        .stat {
            font-weight: bold;
        }

        p {
            line-height: 1.6;
        }

        .small-text {
            font-size: 0.9em;
            color: #555;
        }
    </style>
</head>

<body>
    <h1>Data Analysis Report</h1>

    <div class="section">
        <h2>Missing Value Analysis</h2>
        {% if missing_value_outputs.missing_table_html %}
        <h3>Missing Values Table</h3>
        {{ missing_value_outputs.missing_table_html | safe }}
        <h3>Visualizations</h3>
        <img src="{{ missing_value_outputs.missing_values_barplot }}" alt="Missing Values Barplot">
        <img src="{{ missing_value_outputs.missing_data_matrix }}" alt="Missing Data Matrix">
        <img src="{{ missing_value_outputs.missing_data_heatmap }}" alt="Missing Data Heatmap">
        {% else %}
        <p>No missing values found in the dataset.</p>
        {% endif %}
    </div>

    <div class="section">
        <h2>Outlier Detection</h2>
        <h3>Outlier Counts</h3>
        <table>
            <tr>
                <th>Variable</th>
                <th>Outlier Count</th>
            </tr>
            {% for var, count in outlier_detection_outputs.outlier_counts.items() %}
            <tr>
                <td>{{ var }}</td>
                <td>{{ count }}</td>
            </tr>
            {% endfor %}
        </table>
        <h3>Visualizations</h3>
        {% for item in outlier_detection_outputs.outlier_plots %}
        <h4>Outlier Detection for {{ item.variable }}</h4>
        <img src="{{ item.plot }}" alt="Outlier Plot for {{ item.variable }}">
        {% endfor %}
    </div>

    <div class="section">
        <h2>Descriptive Statistics</h2>
        {% if numerical_describe_html %}
        <h3>Numerical Variables</h3>
        {{ numerical_describe_html | safe }}
        {% endif %}
        {% if categorical_describe_html %}
        <h3>Categorical Variables</h3>
        {% for var, counts_html in categorical_describe_html.items() %}
        <h4>{{ var }}</h4>
        {{ counts_html | safe }}
        {% endfor %}
        {% endif %}
    </div>

    <div class="section">
        <h2>Bivariate Analysis</h2>
        {% for analysis in bivariate_outputs %}
        <h3>Analysis of {{ analysis.variable }} vs {{ analysis.target }} ({{ analysis.type.replace('_', ' ').title() }})
        </h3>
        {% if analysis.result.plot %}
        <img src="{{ analysis.result.plot }}" alt="Plot of {{ analysis.variable }} vs {{ analysis.target }}">
        {% endif %}
        <!-- Include more detailed results based on analysis.type -->
        {% if analysis.type == 'numeric_vs_numeric' %}
        <h4>Correlation Coefficients</h4>
        <p><span class="stat">Pearson Correlation:</span> {{ analysis.result.pearson.correlation | round(3) }} (p = {{
            analysis.result.pearson.p_value | scientific_notation(3) }})</p>
        <p><span class="stat">Spearman Correlation:</span> {{ analysis.result.spearman.correlation | round(3) }} (p = {{
            analysis.result.spearman.p_value | scientific_notation(3) }})</p>
        {% elif analysis.type in ['numeric_vs_categorical', 'categorical_vs_numeric'] %}
        <h4>Descriptive Statistics</h4>
        {% if analysis.result.desc_stats_html %}
        {{ analysis.result.desc_stats_html | safe }}
        {% endif %}
        <h4>Statistical Test</h4>
        <p><span class="stat">Test Used:</span> {{ analysis.result.test.name }}</p>
        <p><span class="stat">Statistic:</span> {{ analysis.result.test.statistic | round(4) }}, <span
                class="stat">p-value:</span> {{ analysis.result.test.p_value | scientific_notation(4) }}</p>
        {% if analysis.result.effect_size %}
        <h4>Effect Size</h4>
        {% for key, value in analysis.result.effect_size.items() %}
        <p><span class="stat">{{ key.replace('_', ' ').title() }}:</span> {{ value | round(3) }}</p>
        {% endfor %}
        {% endif %}
        <h4>Visualizations</h4>
        <img src="{{ analysis.result.boxplot }}" alt="Boxplot of {{ analysis.variable }} by {{ analysis.target }}">
        <img src="{{ analysis.result.violinplot }}"
            alt="Violin Plot of {{ analysis.variable }} by {{ analysis.target }}">
        {% elif analysis.type == 'categorical_vs_categorical' %}
        <h4>Contingency Table</h4>
        {% if analysis.result.contingency_table_html %}
        {{ analysis.result.contingency_table_html | safe }}
        {% endif %}
        <h4>Chi-Squared Test</h4>
        <p><span class="stat">Chi-Squared Statistic:</span> {{ analysis.result.chi_squared.chi2_statistic | round(4) }},
            <span class="stat">p-value:</span> {{ analysis.result.chi_squared.p_value | scientific_notation(4) }}, <span
                class="stat">Degrees of Freedom:</span> {{ analysis.result.chi_squared.degrees_of_freedom }}</p>
        <p><span class="stat">Cram√©r's V:</span> {{ analysis.result.cramers_v | round(3) }} (<span class="stat">{{
                analysis.result.association_strength }}</span> association)</p>
        <h4>Visualization</h4>
        <img src="{{ analysis.result.plot }}"
            alt="Stacked Bar Chart of {{ analysis.variable }} vs {{ analysis.target }}">
        {% endif %}
        {% endfor %}
    </div>

</body>

</html>